# 소셜 규칙 (Social)

## 계정 공개 설정

| 타입 | 설명 |
|------|------|
| 공개 계정 | 누구나 포스트 열람 가능, 팔로우 즉시 완료 |
| 비공개 계정 | 팔로워만 포스트 열람, 팔로우 요청 → 승인 필요 |

## Follow (팔로우)

### 규칙

- 자기 자신 팔로우 불가
- **공개 계정**: 팔로우 즉시 성립 (단방향)
- **비공개 계정**: 팔로우 요청 → 상대방 승인/거절
- 언팔로우는 언제든 가능

### 팔로우 상태

| 상태 | 설명 |
|------|------|
| PENDING | 비공개 계정에 요청, 승인 대기 중 |
| ACCEPTED | 팔로우 성립 |
| (삭제) | 거절 또는 언팔로우 시 레코드 삭제 |

## Block (차단)

### 규칙

- 차단 시 **양방향 팔로우 즉시 해제**
- 차단된 유저는 상대방의 프로필/포스트/워크아웃 열람 불가
- 차단 사실은 상대방에게 알리지 않음
- 차단 해제 후에도 팔로우는 복구되지 않음 (재팔로우 필요)
- 차단된 유저는 상대방을 팔로우할 수 없음

### Block 필터링 적용 범위

차단 관계(양방향)에 있는 유저는 다음 영역에서 완전히 배제된다:

| 영역 | 적용 방식 |
|------|-----------|
| Feed (Post/Workout) | 조회 결과에서 제외 |
| Post 상세 조회 | ForbiddenException 반환 |
| 댓글 목록 | 차단 유저의 댓글 숨김 |
| 좋아요 목록 | 차단 유저의 좋아요 숨김 |
| 팔로워/팔로잉 목록 | 차단 유저 제외 |
| 프로필 조회 | ForbiddenException 반환 |

### Block과 다른 규칙의 상호작용

| 상황 | 동작 |
|------|------|
| 차단 후 기존 댓글/좋아요 | 숨김 처리 (삭제하지 않음) |
| 차단 해제 후 | 팔로우 복구 안 됨, 댓글/좋아요는 다시 보임 |
| 필터링 우선순위 | 1) Soft Delete → 2) Block → 3) Visibility → 4) 권한 매트릭스 |

## DM (Direct Message)

1:1 개인 메시지. 상세 설계는 [dm.md](dm.md) 참조.

### Block과 DM 상호작용

| 상황 | 동작 |
|------|------|
| 차단 후 기존 대화방 | 유지되나 새 메시지 전송 불가 |
| 차단 해제 후 | 대화방 복구, 메시지 전송 가능 |
| 비공개 계정 | 팔로워만 DM 가능 (설정으로 제어 가능) |

## Visibility (공개 범위)

포스트에 적용되는 공개 범위:

| 값 | 설명 |
|----|------|
| PRIVATE | 본인만 볼 수 있음 |
| FOLLOWERS | 팔로워만 볼 수 있음 (기본값) |
| PUBLIC | 누구나 볼 수 있음 |

### 적용 대상

- Post: visibility 필드로 개별 설정
- Workout: 프로필 탭에서 표시되며, 프로필 자체의 공개 설정을 따름
